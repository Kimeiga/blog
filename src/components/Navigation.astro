---
import { SITE_CONFIG } from '../config';

const { pathname } = Astro.url;
---

<nav class="navigation">
  <ul>
    {SITE_CONFIG.navigation.map((item) => {
      const isCurrent = pathname === item.url ||
                       (item.url !== '/' && pathname.startsWith(item.url));
      return (
        <li class={isCurrent ? 'current' : ''}>
          <a
            href={item.url}
            style={`--nav-link-color: ${item.color}`}
          >
            {item.title}
          </a>
        </li>
      );
    })}

    <li class="theme-toggle-item">
      <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark/light mode">
        <span class="theme-icon theme-icon-dark">‚òÄÔ∏è</span>
        <span class="theme-icon theme-icon-light">üåô</span>
      </button>
    </li>
  </ul>
</nav>

<style>
  .navigation a {
    color: var(--nav-link-color);
  }

  .navigation a:hover,
  .navigation a:focus {
    opacity: 0.8;
  }

  .theme-toggle-item {
    margin-left: auto;
  }

  .theme-toggle {
    background: none;
    border: none;
    font-size: inherit;
    cursor: pointer;
    padding: 0.5em var(--nav-item-space);
    line-height: 1;
    opacity: 0.6;
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .theme-toggle:hover,
  .theme-toggle:focus {
    opacity: 1;
    transform: scale(1.1);
  }

  .theme-toggle:focus-visible {
    outline: 2px solid var(--link-color);
    outline-offset: 4px;
    border-radius: 4px;
  }

  .theme-icon {
    display: none;
  }

  /* Show sun icon in dark mode (to switch to light) */
  :root[data-theme="dark"] .theme-icon-dark {
    display: inline;
  }

  /* Show moon icon in light mode (to switch to dark) */
  :root[data-theme="light"] .theme-icon-light {
    display: inline;
  }
</style>

<script>
  // Theme toggle functionality
  const themeToggle = document.getElementById('theme-toggle');
  const root = document.documentElement;

  // Default to dark mode
  const getInitialTheme = () => {
    const stored = localStorage.getItem('theme');
    return stored || 'dark';
  };

  // Set initial theme
  const currentTheme = getInitialTheme();
  root.setAttribute('data-theme', currentTheme);

  // Toggle theme
  themeToggle?.addEventListener('click', () => {
    const current = root.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    root.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
  });
</script>

